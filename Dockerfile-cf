FROM node:25.2.1

WORKDIR /app

COPY package.json pnpm-lock.yaml ./

RUN npm install -g corepack
RUN corepack cache clean
RUN corepack enable

COPY . .

EXPOSE 5173

RUN mkdir -p /root/.config/.wrangler && \
    echo '{"enabled":false}' > /root/.config/.wrangler/metrics.json

RUN npm run build

ENV NODE_ENV=production \
    RUNNING_IN_DOCKER=true

CMD ["pnpm", "run", "dockerstart"]
